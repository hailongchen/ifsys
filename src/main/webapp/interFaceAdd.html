<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>独孤九剑－接口添加</title>
<!-- <link rel="stylesheet" type="text/css" href="info/css/amazeui.min.css"> -->
<link rel="stylesheet"
	href="http://s.amazeui.org/assets/2.x/css/amazeui.min.css?v=idfai718">
<link rel="stylesheet" type="text/css" href="css/style.css">
<script type="text/javascript" src="info/js/jquery.min.js"></script>
<script src="info/js/amazeui.min.js"></script>
<script src="js/plugin/myThirdPlugin.js"></script>
<script src="js/interFaceSys.js"></script>
<script type="text/javascript">
	$(function() {
		//加载系统信息
    gigold.pay.interFace.ajaxHandler({
			"url":"getAllSysInfo.do",
			"onSuccess":function(data){
				if (data.rspCd == "00000") {
                    $.each(data.sysList, function(index, sysData) {
                        var optionStr = '<option value="'+sysData.id+'"">'
                                + sysData.sysName + '</option>';
                        console.log(optionStr);
                        $("#ifSysId").append(optionStr);
                    });
                }
			}
		});
		
		//加载产品信息
		 gigold.pay.interFace.ajaxHandler({
	            "url":"getAllProInfo.do",
	            "onSuccess":function(data){
	            	if (data.rspCd == "00000") {
	                    $.each(data.proList, function(index, proData) {
	                        var optionStr = '<option value="'+proData.id+'">'
	                                + proData.proName + '</option>';
	                        $("#ifProId").append(optionStr);
	                    });
	                }
	            }
	        });
		
       //接口基本信息保存按钮功能
		$("#saveInterFaceBtn").click(function() {
			var sendData = {};
			sendData.interFaceInfo = $('#interFaceForm').serializeJson();
			gigold.pay.interFace.ajaxHandler({
	                "url":"addInterface.do",
	                "data":JSON.stringify(sendData),
	                "onSuccess":function(data){
	                	 if (data.rspCd == "00000") {
	                		 //保存成功取消遮罩
	                		 $(".maskBox").removeClass("maskBox");
	                          alert("保存成功");
	                           $("#ifId").val(data.interFaceInfo.id);
	                      }else{
	                          alert("保存失败");
	                      }
	                }
	            });
			
		});
	});

	//保存按钮
	$(document).on("click", ".saveBtn", function() {
		//获取按钮所在的form对象
		var recordForm = $(this).parent().parent();
		var sendData={};
		sendData.interFaceField=$(recordForm).serializeJson();
		sendData.interFaceField.ifId=$("#ifId").val();
		
		$(recordForm).find("button[type=button]").removeClass("am-disabled");
        $(recordForm).find(".saveBtn").addClass("am-disabled");
        $(recordForm).find(".cancleCurBtn").addClass("am-disabled");
		
		/*
		   保存成功后获取字段的ID更新id＝"fieldId"的隐藏域
		
		*/
		console.log(sendData);
		$(recordForm).find("button[type=button]").removeClass("am-disabled");
        $(recordForm).find(".saveBtn").addClass("am-disabled");
        $(recordForm).find(".cancleCurBtn").addClass("am-disabled");
		  gigold.pay.interFace.ajaxHandler({
             "url":"addInterFaceField.do",
             "data":JSON.stringify(sendData),
             "onSuccess":function(data){
            	 if (data.rspCd == "00000") {
            		 $(recordForm).find(".fieldId").val(data.interFaceField.id);
                     $(recordForm).find(".levelCode").val(data.interFaceField.id);
                     console.log(data);
                     alert("保存成功");
                     $(recordForm).find("button[type=button]").removeClass("am-disabled");
                     $(recordForm).find(".saveBtn").addClass("am-disabled");
                     $(recordForm).find(".cancleCurBtn").addClass("am-disabled");
                 }else{
                     alert("保存失败");
                 }
             }
         }); 
	});

	//添加同级节点按钮
    $(document).on("click",".addCurBtn",function() {
        //获取按钮所在的form对象
        var recordForm = $(this).parent().parent();
        //复制一份form对象
        var cloneForm = $(recordForm).clone();
        //应该清空表单所有录入项
       $(cloneForm).find("input[type!=hidden]").find("input[name!=fieldStatusCode]").val("");
       $(cloneForm).find(".am-btn-default").addClass("am-disabled");
       $(cloneForm).find(".saveBtn").removeClass("am-disabled");
       $(cloneForm).find(".cancleCurBtn").show().removeClass("am-disabled");
        //在当前form后面新增一个form
        $(recordForm).after(cloneForm);
    });
	
  //添加子节点按钮
    $(document).on("click",".addChildBtn",function() {
        //获取按钮所在的form对象
        var recordForm = $(this).parent().parent();
        //复制一份form对象
        var cloneForm = $(recordForm).clone();
        //获取隐藏域
        $(cloneForm).find("input[name=parentId]").val($(cloneForm).find(".fieldId").val());
        //应该清空表单所有录入项
        $(cloneForm).find("input[type!=hidden]").find("input[name!=fieldStatusCode]").val("");
        $(cloneForm).find(".am-btn-default").addClass("am-disabled");
        $(cloneForm).find(".saveBtn").removeClass("am-disabled");
        $(cloneForm).find(".cancleCurBtn").show().removeClass("am-disabled");
        //在当前form后面新增一个form
        $(recordForm).after(cloneForm);
        $(cloneForm).find(".show").append("-->"+ $(recordForm).find("input[name=fieldName]").val());
    });
  //删除字段按钮
    $(document).on("click",".deleteCurBtn",function() {
        //获取按钮所在的form对象
        var recordForm = $(this).parent().parent();
        var recordForm = $(this).parent().parent();
        var sendData={};
        sendData.interFaceField=$(recordForm).serializeJson();
        sendData.interFaceField.ifId=$("#ifId").val();
        gigold.pay.interFace.ajaxHandler({
            "url":"deleteFieldByLevel.do",
            "data":JSON.stringify(sendData),
            "onSuccess":function(data){
                if (data.rspCd == "00000") {
                	 $(recordForm).remove();
                }else{
                    alert("删除失败");
                }
            }
        });
       
    });
	
	
    
  //取消按钮
    $(document).on("click",".cancleCurBtn",function() {
        //获取按钮所在的form对象
        var recordForm = $(this).parent().parent();
        $(recordForm).remove();
    });
	
	
</script>

</head>

<body>
	<header data-am-widget="header"
		class="am-header am-header-default am-titlebar am-no-layout">
		<h1 class="titleH1">
			<a>独孤九剑</a>
		</h1>
		<ol class="am-breadcrumb" style="margin: 0;">
			<li><a href="">首页</a></li>
			<li class="am-active">添加接口</li>
			<div class="loggxnxi">
				登陆用户：<span class="userName colorName">11111</span>
			</div>
		</ol>
		<div class="am-header-right am-header-nav">
			<i class="am-header-icon am-icon-bars" title="开发ing..."> </i>
			<div class="am-dropdown" data-am-dropdown>
				<button class="am-btn am-btn-primary am-dropdown-toggle menu"
					data-am-dropdown-toggle>
					查看功能<span class="am-icon-caret-down"></span>
				</button>
				<ul class="am-dropdown-content">
					<li><a href="main.html">接口查询</a></li>
					<li><a href="interFaceAdd.html">添加接口</a></li>
				</ul>
			</div>
		</div>
	</header>

	<div class="am-g am-g-fixed">
		<form id="interFaceForm">
			<table class="am-table am-table-hover" style="margin-top: 60px;">
				<thead>
					<th style="text-align: center;" colspan="2">接口基本信息添加</th>
				</thead>
				<tbody>
					<tr>
						<td class="am-text-right">接口名字:</td>
						<td><input id="ifName" name="ifName" placeholder="输入接口名" />
						</td>

					</tr>
					<tr>
						<td class="am-text-right">接口描述信息:</td>
						<td><input id="ifDesc" name="ifDesc" placeholder="输入接口描述" />
						</td>
					</tr>
					<tr>
						<td class="am-text-right">接口URL:</td>
						<td><input id="ifUrl" name="ifUrl" placeholder="输入接口URL" />
						</td>
					</tr>
					<tr>
						<td class="am-text-right">所属系统:</td>
						<td><select id="ifSysId" name="ifSysId"
							data-am-selected="{btnWidth: '20%'}">
								<option value="0" selected>请选择所属系统</option>
						</select></td>
					</tr>
					<tr>
						<td class="am-text-right">所属产品:</td>
						<td><select id="ifProId" name="ifProId"
							data-am-selected="{btnWidth: '20%'}">
								<option value="0" selected>请选择所属产品</option>
						</select></td>
					</tr>
					<tr>
						<td class="am-text-right">接口协议:</td>
						<td><select id="ifProtocol" name="ifProtocol"
							data-am-selected="{btnWidth: '20%'}">
								<option value="HTTP" selected>HTTP</option>
								<option value="FTP">FTP</option>
						</select></td>
					</tr>
					<tr>
						<td class="am-text-right">接口请求方式:</td>
						<td><select id="ifType" name="ifType"
							data-am-selected="{btnWidth: '20%'}">
								<option value="POST" selected>POST</option>
								<option value="GET">GET</option>
						</select>
							<button id="saveInterFaceBtn" type="button"
								class="am-btn am-btn-success" style="width: 20%; float: right;">保存</button>
						</td>
					</tr>
				</tbody>
			</table>
		</form>

		<div class="maskBox">
			<table class="am-table am-table-hover" style="margin-top: 60px;">
				<thead>
					<th style="text-align: center;" colspan="2">接口请求信息定义</th>
				</thead>
				<tbody>
					<tr>
						<td>
							<form>
							 <div class="show"></div>
								<input type="hidden" class="fieldId" name="id"/>
								<input type="hidden" name="parentId" value="0"/>
								<input type="hidden" name="fieldFlag" value="1"/>
								<input type="hidden" class="levelCode" name="level"/><!-- 字段层级 -->
								<div>
									字段名：<input name="fieldName" placeholder="请输入字段名" />  
									字段描述(注解)：<input name="fieldDesc" placeholder="请输入字段描述" /> 
									字段约束： 
                                    <select  name="fieldCheck">
                                        <option value="0" selected >请添加约束</option>
                                        <option value="3">电子邮箱</option>
                                        <option value="4">数组</option>
                                    </select>
                                    <br>例子：<input name="fieldReferValue"
										placeholder="请输入字段例子" />
								</div>
								<div style="text-align: right;">
									<button type="button" class="addCurBtn am-btn am-btn-default am-disabled">添加同级字段</button>
									<button type="button" class="addChildBtn am-btn am-btn-default am-disabled">添加子字段</button>
									<button type="button" class="deleteCurBtn am-btn am-btn-default am-disabled">删除字段</button>
									<button type="button" class="saveBtn am-btn am-btn-success">保存</button>
									<button type="button" class="cancleCurBtn am-btn am-btn-success" style="display: none">取消添加</button>
									
								</div>
								
							</form>
						</td>
					</tr>



				</tbody>
			</table>
		</div>


		<div class="maskBox">
			<table class="am-table am-table-hover" style="margin-top: 60px;">
				<thead>
					<th style="text-align: center;" colspan="2">接口响应部分定义</th>
				</thead>
				<tbody>
				<!-- <tr><td>
				    添加返回码：<input name="fieldStatusCode" placeholder="请输入返回码" /><button type="button" class="addCurBtn am-btn am-btn-default am-disabled">添加同级字段</button>
				</td></tr> -->
					<tr>
						<td>
						   
							<form>
                             <div class="show"></div>
                                <input type="hidden" class="fieldId" name="id"/>
                                <input type="hidden" name="parentId" value="0"/>
                                <input type="hidden" name="fieldFlag" value="2"/>
                                <input type="hidden" class="levelCode" name="level"/><!-- 字段层级 -->
                                <div>
                                    <br> 
                                    字段名：<input name="fieldName" placeholder="请输入字段名" />  
                                    字段描述(注解)：<input name="fieldDesc" placeholder="请输入字段描述" /> 
                                    字段约束： 
                                    <select  name="fieldCheck">
                                        <option value="0" selected >请添加约束</option>
                                        <option value="3">电子邮箱</option>
                                        <option value="4">数组</option>
                                    </select>
                                    <br>例子：<input name="fieldReferValue"
                                        placeholder="请输入字段例子" />
                                </div>
                                <div style="text-align: right;">
                                    <button type="button" class="addCurBtn am-btn am-btn-default am-disabled">添加同级字段</button>
                                    <button type="button" class="addChildBtn am-btn am-btn-default am-disabled">添加子字段</button>
                                    <button type="button" class="deleteCurBtn am-btn am-btn-default am-disabled">删除字段</button>
                                    <button type="button" class="saveBtn am-btn am-btn-success">保存</button>
                                    <button type="button" class="cancleCurBtn am-btn am-btn-success" style="display: none">取消添加</button>
                                    
                                </div>
                                
                            </form>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
<input id="ifId" type="hidden" value="">

</body>

</html>
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gigold.pay.autotest.dao.IfSysMockDAO">

	<resultMap type="com.gigold.pay.autotest.bo.IfSysMock" id="ifSysMockResultMap">
		<id property="id" column="ID" />
		<result property="ifId" column="IF_ID" />
		<result property="rspCodeId" column="RSP_CODE_ID" />
		<result property="rspCode" column="RSP_CODE" />
		<result property="requestJson" column="REQUEST_JSON" />
		<result property="responseJson" column="RESPONSE_JSON" />
		<result property="realRspCode" column="REAL_RSP_CODE" />
		<result property="realResponseJson" column="REAL_RESPONSE_JSON" />
		<result property="testResult" column="TEST_RESULT" />
		<!-- 额外的接口信息数据 @chenkuan 2015.12.08 -->
		<result property="ifName" column="IF_NAME" />
		<result property="ifURL" column="IF_URL" />
		<result property="ifPROTOCOL" column="IF_PROTOCOL" />
		<result property="ifDESC" column="IF_DESC" />

	</resultMap>

	<insert id="addIfSysMock" parameterType="com.gigold.pay.autotest.bo.IfSysMock"
		useGeneratedKeys="true" keyProperty="id">
        <![CDATA[  
        insert into
        T_IF_AUTO_MOCK
        (
         IF_ID,
         RSP_CODE_ID,
         REQUEST_JSON,
         RESPONSE_JSON
        )
        values(
        #{ifId},
        #{rspCodeId},
        #{requestJson},
        #{responseJson})
    ]]>
	</insert>
	 <!-- 修改模拟数据  -->
	<update id="updateIfSysMock" parameterType="com.gigold.pay.autotest.bo.IfSysMock">
		update T_IF_AUTO_MOCK
		<set>
		<if test="rspCodeId!=null and rspCodeId!=''">
				RSP_CODE_ID=#{rspCodeId},
			</if>
			<if test="requestJson!=null and requestJson!=''">
				REQUEST_JSON=#{requestJson},
			</if>
			<if test="responseJson!=null and responseJson!=''">
				RESPONSE_JSON=#{responseJson},
			</if>
			<if test="realRspCode!=null and realRspCode!=''">
				REAL_RSP_CODE=#{realRspCode},
			</if>
			<if test="realResponseJson!=null and realResponseJson!=''">
				REAL_RESPONSE_JSON=#{realResponseJson},
			</if>
			<if test="testResult!=null and testResult!=''">
				TEST_RESULT=#{testResult},
			</if>
		</set>
		where ID =#{id}
	</update>
	
	 <!-- 根据ID删除模拟数据  -->
	<update id="deleteIfSysMockById" parameterType="int">
		update T_IF_AUTO_MOCK
		set STATUS='N'
		where ID =#{id}
	</update>
	<!-- 根据IF_ID删除模拟数据  -->
	<update id="deleteIfSysMockByIfId" parameterType="int">
		update T_IF_AUTO_MOCK
		set STATUS='N'
		where IF_ID =#{ifId}
	</update>
	<!-- 根据接口ID获取测试数据信息  编辑页,新增页 -->
	<select id="getMockInfoByIfId" parameterType="int" resultMap="ifSysMockResultMap">
     <![CDATA[ 
		select ID,
		IF_ID,
		RSP_CODE_ID,
		REQUEST_JSON,
		RESPONSE_JSON,
		REAL_RSP_CODE,
		REAL_RESPONSE_JSON,
		TEST_RESULT
		from T_IF_AUTO_MOCK
		where IF_ID=#{ifId}
		and STATUS='Y'
		 
      ]]>
	</select>
	
	<!-- 根据ID获取测试数据信息 -->
	<select id="getMockInfoById" parameterType="int" resultMap="ifSysMockResultMap">
     <![CDATA[ 
		select ID,
		IF_ID,
		RSP_CODE_ID,
		REQUEST_JSON,
		RESPONSE_JSON,
		REAL_RSP_CODE,
		REAL_RESPONSE_JSON,
		TEST_RESULT
		from T_IF_AUTO_MOCK
		where ID=#{id}
		and STATUS='Y'
		 
      ]]>
	</select>
	
<!-- 根据接口ID和返回码ID获取测试数据信息-->
	<select id="getMockInfoByIfIdAndRspCdId" parameterType="com.gigold.pay.autotest.bo.IfSysMock" resultMap="ifSysMockResultMap">
     <![CDATA[ 
		select ID,
		IF_ID,
		RSP_CODE_ID,
		REQUEST_JSON,
		RESPONSE_JSON,
		REAL_RSP_CODE,
		REAL_RESPONSE_JSON,
		TEST_RESULT
		from T_IF_AUTO_MOCK
		where IF_ID=#{ifId}
		and RSP_CODE_ID=#{rspCodeId}
		and STATUS='Y'
		 
      ]]>
	</select>
	<!-- 根据筛选条件获取测试数据信息 chenkuan @2015-12-08 -->
	<select id="filterMocksByStatus" parameterType="String" resultMap="ifSysMockResultMap">
		<![CDATA[
		SELECT
			a.ID,
			b.IF_NAME,b.IF_DESC,b.IF_URL,b.IF_PROTOCOL,
			a.IF_ID,
			a.RSP_CODE,
			a.REQUEST_JSON,
			a.RESPONSE_JSON,
			a.REAL_RSP_CODE,
			a.REAL_RESPONSE_JSON,
			a.TEST_RESULT,
			a.TM_SMP

 		FROM
 			T_IF_AUTO_MOCK a left outer join T_IF_INTERFACE b ON a.IF_ID = b.ID
 		WHERE
 			a.TEST_RESULT=#{testResult} and STATUS='Y'
      ]]>
	</select>

	<!-- 筛选出没有通过的测试数据  chenkuan @2015-12-08 -->
	<select id="filterMocksByFailed" resultMap="ifSysMockResultMap">
		<![CDATA[
		SELECT
			a.ID,
			b.IF_NAME,b.IF_DESC,b.IF_URL,b.IF_PROTOCOL,
			a.IF_ID,
			a.RSP_CODE,
			a.REQUEST_JSON,
			a.RESPONSE_JSON,
			a.REAL_RSP_CODE,
			a.REAL_RESPONSE_JSON,
			a.TEST_RESULT,
			a.TM_SMP
 		FROM
 			T_IF_AUTO_MOCK a left outer join T_IF_INTERFACE b ON a.IF_ID = b.ID
 		WHERE
 			(ISNULL(a.TEST_RESULT) or a.TEST_RESULT!=1) and STATUS='Y'
      ]]>
	</select>

	<!-- 筛选所有测试过的数据  chenkuan @2015-12-08 -->
	<select id="filterAllTestedMocks" resultMap="ifSysMockResultMap">
		<![CDATA[
		SELECT
			a.ID,
			b.IF_NAME,b.IF_DESC,b.IF_URL,b.IF_PROTOCOL,
			a.IF_ID,
			a.RSP_CODE,
			a.REQUEST_JSON,
			a.RESPONSE_JSON,
			a.REAL_RSP_CODE,
			a.REAL_RESPONSE_JSON,
			a.TEST_RESULT,
			a.TM_SMP
 		FROM
 			T_IF_AUTO_MOCK a left outer join T_IF_INTERFACE b ON a.IF_ID = b.ID
 		WHERE
 			(a.TEST_RESULT='-1' or a.TEST_RESULT='1' or a.TEST_RESULT='0') and STATUS='Y'
      ]]>
	</select>

	<!-- 根据ID回写响应报文到测试数据对应的信息中 -->
	<update id="writeBack" parameterType="com.gigold.pay.autotest.bo.IfSysMock">
	    <![CDATA[
	    update T_IF_AUTO_MOCK
	    set REAL_RSP_CODE=#{realRspCode},
	    REAL_RESPONSE_JSON=#{realResponseJson},
	    TEST_RESULT=#{testResult}
	    where id=#{id}
	    
	    ]]>
	</update>

</mapper>
 
 
 
 
 
 